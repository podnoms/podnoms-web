<div *ngIf="profile$ | async; let profile; else loading"
    class="block">
    <ul class="nav nav-tabs nav-tabs-alt"
        data-toggle="tabs"
        role="tablist">
        <li class="nav-item">
            <a class="nav-link active"
                data-toggle="tab"
                href="#btabs-podcast-details">
                <i class="fa fa-info text-primary"></i>&nbsp;Details
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
                data-toggle="tab"
                href="#btabs-podcast-notifications">
                <i class="fa fa-bell text-primary"></i>&nbsp;Notifications
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
                data-toggle="tab"
                href="#btabs-podcast-apikeys">
                <i class="fas fa-key text-primary"></i>&nbsp;API Keys
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
                data-toggle="tab"
                href="#btabs-podcast-opml">
                <i class="fas fa-rss text-primary"></i>&nbsp;OPML Feed
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
                data-toggle="tab"
                href="#btabs-podcast-payments">
                <i class="fa fa-coins text-primary"></i>&nbsp;Payments
            </a>
        </li>
        <li class="nav-item ml-auto">
            <div class="block-options mr-15 mt-5">
                <button type="submit"
                    class="btn btn-outline-secondary"
                    (click)="doSave(profile)"
                    [disabled]="slugError">
                    <i class="fa fa-save mr-5"></i>Update Profile
                </button>
            </div>
        </li>
    </ul>
    <div class="block-content tab-content">
        <div class="tab-pane active"
            id="btabs-podcast-details"
            role="tabpanel">
            <div class="block">
                <div class="block-content">
                    <div class="row">
                        <div class="col-md-7">
                            <form action=""
                                method="post"
                                onsubmit="return false;">
                                <div class="row">
                                    <div class="col-md-7">
                                        <div class="form-group row">
                                            <div class="col-6">
                                                <label for="first-name">Firstname</label>
                                                <input type="text"
                                                    class="form-control form-control-lg-disabled"
                                                    name="first-name"
                                                    [(ngModel)]="profile.firstName">
                                            </div>
                                            <div class="col-6">
                                                <label for="last-name">Lastname</label>
                                                <input type="text"
                                                    class="form-control form-control-lg-disabled"
                                                    name="last-name"
                                                    [(ngModel)]="profile.lastName">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-5">
                                        <div class="form-group row">
                                            <div class="col-12">
                                                <label for="slug-box">Username</label>
                                                <div class="input-group"
                                                    [ngClass]="slugError ? 'is-invalid' : ''">
                                                    <input type="text"
                                                        class="form-control form-control-lg-disabled"
                                                        id="slug-box"
                                                        name="slug-box"
                                                        autocomplete="off"
                                                        required=""
                                                        [(ngModel)]="profile.slug"
                                                        (keyup)="searchTerm$.next($event.target.value)">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text input-group-lg">
                                                            <i class="fa fa-asterisk"
                                                                [ngClass]="slugging ? 'fa-spin' : ''"></i>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback"
                                            *ngIf="slugError">{{slugError}}</div>
                                        <div class="form-text text-muted text-danger">
                                            Changing this will change all your RSS URLs but we will redirect the old one to the new one.
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-3">
                                        <label for="twitter-handle">Twitter Handle</label>
                                        <input type="text"
                                            class="form-control form-control-lg-disabled"
                                            name="twitter-handle"
                                            [(ngModel)]="profile.twitterHandle">
                                        <div class="form-text text-muted text-danger">
                                            You will need to fill this if you want to create an episode by replying to a tweet
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-12">
                                        <label for="mega-bio">Profile
                                            Image</label>
                                        <app-image-upload [imageUrl]="profile.profileImageUrl"
                                            [allowRandom]="true"
                                            #imageControl></app-image-upload>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-5">
                            <div class="block">
                                <div class="block-header block-header-default">
                                    <h3 class="block-title">Disk
                                        Quota:
                                        {{storageAvailable|bytesToHuman}}</h3>
                                </div>
                                <div class="block-content">
                                    <div class="js-pie-chart pie-chart js-pie-chart-enabled">
                                        <canvas baseChart
                                            #usageChart
                                            class="chart"
                                            [data]="chartData"
                                            [labels]="chartLabels"
                                            [chartType]="'doughnut'"
                                            [options]="chartOptions">
                                        </canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="tab-pane"
            id="btabs-podcast-notifications"
            role="tabpanel">
            <app-user-notifications-settings [user]="profile"></app-user-notifications-settings>
        </div>
        <div class="tab-pane"
            id="btabs-podcast-apikeys"
            role="tabpanel">
            <app-api-keys [user]="profile"></app-api-keys>
        </div>
        <div class="tab-pane"
            id="btabs-podcast-opml"
            role="tabpanel">
            <app-opml></app-opml>
        </div>
        <div class="tab-pane"
            id="btabs-podcast-payments"
            role="tabpanel">
            <app-payment-list></app-payment-list>
        </div>
    </div>
</div>

<ng-template #loading>
    <app-loader [loadingText]="'Loading....'">
    </app-loader>
</ng-template>
